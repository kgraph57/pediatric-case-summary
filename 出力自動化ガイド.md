# 症例要約の自動出力ガイド

## 🎯 目的

AIで作成した症例要約を、**ルールに完全準拠したWord/PDF形式で自動出力**する。フォント、文字サイズ、レイアウトを手動調整する必要をなくす。

---

## 📋 出力形式の要件

### Word形式（.docx）
- **フォント**: MS明朝（和文）、Times New Roman（欧文）
- **文字サイズ**: 10.5pt～12pt
- **行間**: 適切な行間（30行以内に収める）
- **改行**: 各項目（【主訴】など）の冒頭でのみ改行
- **ページ設定**: A4サイズ、適切な余白

### PDF形式
- **フォント**: MS明朝（和文）、Times New Roman（欧文）
- **文字サイズ**: 10.5pt～12pt
- **レイアウト**: Word形式と同じ
- **印刷用**: A4サイズ、適切な余白

---

## 🛠️ 実装方法

### 方法1: Pythonスクリプト（推奨・最も簡単）

#### 必要なライブラリ
```bash
pip install python-docx reportlab
```

#### 基本的なスクリプト例

```python
from docx import Document
from docx.shared import Pt, RGBColor
from docx.enum.text import WD_PARAGRAPH_ALIGNMENT
import re

def create_case_summary_docx(case_data, output_path):
    """
    症例要約をWord形式で出力
    
    Args:
        case_data: 症例データ（辞書形式）
        output_path: 出力ファイルパス
    """
    doc = Document()
    
    # フォント設定
    style = doc.styles['Normal']
    font = style.font
    font.name = 'MS Mincho'  # 和文フォント
    font.size = Pt(11)  # 11pt
    
    # 基本情報セクション
    p = doc.add_paragraph()
    p.add_run(f"症例番号: {case_data['case_number']}").bold = True
    if case_data.get('is_designated_disease'):
        p.add_run(" ○")  # 指定疾患マーク
    
    p = doc.add_paragraph()
    p.add_run(f"分野番号: {case_data['field_number']}")
    
    p = doc.add_paragraph()
    p.add_run(f"患者ID: {case_data['patient_id']}")
    
    p = doc.add_paragraph()
    p.add_run(f"入院・外来: {'入院症例' if case_data['is_inpatient'] else '外来症例'}")
    
    p = doc.add_paragraph()
    p.add_run(f"受け持ち期間: {case_data['care_period']}")
    
    p = doc.add_paragraph()
    p.add_run(f"年齢: {case_data['age']}")
    
    p = doc.add_paragraph()
    p.add_run(f"性別: {'男' if case_data['gender'] == 'male' else '女'}")
    
    p = doc.add_paragraph()
    p.add_run(f"転帰: {case_data['outcome']}")
    
    # 本文セクション（30行以内に収める）
    doc.add_paragraph()  # 空行
    
    # 主訴
    p = doc.add_paragraph()
    p.add_run("【主訴】").bold = True
    p.add_run(f" {case_data['chief_complaint']}")
    
    # 現病歴
    p = doc.add_paragraph()
    p.add_run("【現病歴】").bold = True
    p.add_run(f" {case_data['present_illness']}")
    
    # 診察所見
    p = doc.add_paragraph()
    p.add_run("【入院時診察所見】").bold = True
    p.add_run(f" {case_data['physical_examination']}")
    
    # 検査所見
    p = doc.add_paragraph()
    p.add_run("【入院時検査所見】").bold = True
    p.add_run(f" {case_data['laboratory_findings']}")
    
    # 鑑別診断
    p = doc.add_paragraph()
    p.add_run("【鑑別診断】").bold = True
    for i, dd in enumerate(case_data['differential_diagnoses'], 1):
        p.add_run(f" {i}. {dd}。")
    
    # 入院後経過
    p = doc.add_paragraph()
    p.add_run("【入院後経過】").bold = True
    p.add_run(f" {case_data['hospital_course']}")
    
    # 家族への説明
    p = doc.add_paragraph()
    p.add_run("【家族への説明・指示】").bold = True
    p.add_run(f" {case_data['family_explanation']}")
    
    # 保存
    doc.save(output_path)
    print(f"✅ Wordファイルを出力しました: {output_path}")

# 使用例
case_data = {
    'case_number': 1,
    'is_designated_disease': True,
    'field_number': 3,
    'patient_id': 'P12345',
    'is_inpatient': True,
    'care_period': '2024年4月1日～2024年4月15日',
    'age': '生後2か月',
    'gender': 'male',
    'outcome': '治癒',
    'chief_complaint': '発熱と咳嗽で来院',
    'present_illness': '1か月前から軽い咳があったが、3日前から発熱（38.5度）と咳嗽が悪化。',
    'physical_examination': '体温 38.5度、呼吸数 40回/分、脈拍 130回/分。',
    'laboratory_findings': 'WBC 12500/μL、Hb 11.2 g/dL、CRP 2.5 mg/dL。',
    'differential_diagnoses': ['RSウイルス感染症', '細菌性肺炎'],
    'hospital_course': '入院3日目に解熱、7日目に退院。',
    'family_explanation': 'RSウイルス感染症について説明し、今後の注意点を説明した。'
}

create_case_summary_docx(case_data, '症例要約_症例1.docx')
```

---

### 方法2: AI（Cursor/ChatGPT）に直接依頼

#### 依頼方法

```
以下の症例要約を、ルールに完全準拠したWord形式で出力してください。

【要件】
- フォント: MS明朝（和文）、Times New Roman（欧文）
- 文字サイズ: 11pt
- 30行以内に収める
- 各項目（【主訴】など）の冒頭でのみ改行
- 数字はすべて半角
- 単位のスペースはルールに従う

【症例要約テキスト】
[ここにAIが作成した症例要約を貼り付け]

【出力形式】
Word形式（.docx）で出力してください。
```

#### AIがやること
1. テキストを解析
2. Word形式で整形
3. フォント・文字サイズを設定
4. ルールに従って整形
5. .docxファイルを生成（または生成コードを提供）

---

### 方法3: 一括出力スクリプト（30症例まとめて）

```python
from docx import Document
from docx.shared import Pt
import json

def create_all_case_summaries(cases_data, output_path):
    """
    30症例すべてを1つのWordファイルに出力
    
    Args:
        cases_data: 症例データのリスト
        output_path: 出力ファイルパス
    """
    doc = Document()
    
    # フォント設定
    style = doc.styles['Normal']
    font = style.font
    font.name = 'MS Mincho'
    font.size = Pt(11)
    
    # 各症例を追加
    for case in cases_data:
        # 症例番号でソート（分野番号順）
        pass
    
    # 症例を追加
    for case in sorted(cases_data, key=lambda x: (x['field_number'], x['case_number'])):
        # 症例区切り
        doc.add_paragraph("=" * 50)
        doc.add_paragraph()
        
        # 症例要約を追加
        create_case_summary_section(doc, case)
        
        # ページ区切り（必要に応じて）
        doc.add_page_break()
    
    doc.save(output_path)
    print(f"✅ 全症例を出力しました: {output_path}")

# 使用例
with open('cases.json', 'r', encoding='utf-8') as f:
    cases_data = json.load(f)

create_all_case_summaries(cases_data, '症例要約_全30症例.docx')
```

---

## 🚀 実践的なワークフロー

### Step 1: AIに症例要約を作成してもらう

```
症例番号1、分野番号3、指定疾患ありです。
以下の情報から症例要約を作成してください。

[カルテから抜き出した情報を貼り付け]
```

### Step 2: AIにWord形式で出力してもらう

```
上記の症例要約を、以下の要件でWord形式（.docx）で出力してください。

【出力要件】
- フォント: MS明朝（和文）、Times New Roman（欧文）
- 文字サイズ: 11pt
- 30行以内に収める
- 各項目（【主訴】など）の冒頭でのみ改行
- 数字はすべて半角
- 単位のスペースはルールに従う
- ページ設定: A4サイズ

【出力方法】
Pythonのpython-docxライブラリを使用したコードを生成してください。
実行するとWordファイルが生成されるようにしてください。
```

### Step 3: 生成されたコードを実行

```bash
python generate_word.py
```

### Step 4: Wordファイルを確認

- フォントが統一されているか
- 文字サイズが適切か
- 30行以内に収まっているか
- レイアウトが適切か

---

## 💡 さらに便利にする方法

### 方法A: AIに直接Wordファイルを生成してもらう（Cursorの場合）

Cursorでは、AIが直接ファイルを生成できます。

```
以下の症例要約をWord形式で出力してください。
ファイル名: 症例要約_症例1.docx

[症例要約テキストを貼り付け]
```

### 方法B: テンプレートを使う

事前にテンプレートを作成しておき、AIに「このテンプレートを使って」と指示。

```python
# テンプレートファイル: case_template.docx
# AIがこのテンプレートを読み込んで、内容を埋め込む
```

### 方法C: 一括処理

30症例すべてのテキストをまとめて送り、一括でWordファイルを生成。

```
以下の30症例すべてを、1つのWordファイルにまとめて出力してください。
各症例はページ区切りで分けてください。

[30症例すべてのテキストを貼り付け]
```

---

## 📝 実際の使用例

### 例1: 単一症例の出力

```
【ユーザー】
症例要約を作成して、Word形式で出力してください。

症例番号: 1
分野番号: 3
指定疾患: あり

[カルテ情報を貼り付け]

【AI】
症例要約を作成し、Word形式で出力します。
→ case_summary_1.docx を生成
```

### 例2: 複数症例の一括出力

```
【ユーザー】
以下の10症例すべてを、1つのWordファイルにまとめて出力してください。

症例1: [テキスト]
症例2: [テキスト]
...
症例10: [テキスト]

【AI】
10症例すべてを1つのWordファイルにまとめて出力します。
→ case_summaries_1-10.docx を生成
```

### 例3: 全30症例の最終出力

```
【ユーザー】
全30症例すべてを、提出用のWordファイルとして出力してください。
各症例はページ区切りで分け、フォント・文字サイズを統一してください。

[30症例すべてのテキストを貼り付け]

【AI】
全30症例を提出用Wordファイルとして出力します。
→ 症例要約_提出用.docx を生成
```

---

## ✅ 出力ファイルの確認項目

### 自動チェック（AIが行う）
- ✅ フォントが統一されているか（MS明朝、Times New Roman）
- ✅ 文字サイズが適切か（10.5pt～12pt）
- ✅ 数字がすべて半角か
- ✅ 単位のスペースが正しいか
- ✅ 句読点が、。で統一されているか
- ✅ 30行以内に収まっているか
- ✅ 各項目の冒頭でのみ改行されているか

### ユーザーが確認すること
- ✅ 医学的内容が正確か
- ✅ 数値が正しいか
- ✅ 診断名が正しいか

---

## 🎯 理想的なワークフロー（完全版）

### 1. 情報収集（5-10分/症例）
- カルテから情報を抜き出す（コピペでOK）

### 2. AIに症例要約を作成してもらう（1-2分/症例）
- テキスト形式で症例要約を作成

### 3. 内容確認（2-3分/症例）
- 医学的内容を確認

### 4. AIにWord形式で出力してもらう（数秒）
- 「Word形式で出力してください」と依頼
- AIが自動でWordファイルを生成

### 5. 最終確認（1分/症例）
- Wordファイルを開いて確認
- 問題なければ完了

### 合計時間: 約10-15分/症例（従来の40-60分から大幅短縮）

---

## 📦 必要なツール

### 方法1: Pythonスクリプト（推奨）
- Python 3.8以上
- python-docx ライブラリ
- reportlab ライブラリ（PDF出力の場合）

### 方法2: AI直接生成（最も簡単）
- Cursor または ChatGPT Plus
- ファイル生成機能

### 方法3: Webアプリ（将来的）
- ブラウザで動作
- ワンクリックでWord/PDF出力

---

## 🚀 次のステップ

1. **まず1症例で試す**
   - AIに症例要約を作成してもらう
   - AIにWord形式で出力してもらう
   - 結果を確認

2. **10症例で試す**
   - 一括出力を試す
   - 効率を確認

3. **全30症例で実践**
   - 全症例を一括出力
   - 提出用ファイルとして完成

---

**この方法で、出力も完全自動化され、手動調整が一切不要になります！**
