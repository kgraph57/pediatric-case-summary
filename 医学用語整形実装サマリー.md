# 医学用語整形機能 実装サマリー

## 作成されたファイル

### 1. `医学用語ルール定義.json`
医学用語・表現のルールを構造化して定義したJSONファイル。

**主な内容：**
- 人名由来病名の変換ルール
- 検査名の変換ルール
- 薬剤呼称の変換ルール
- 医学用語表記のルール
- ひらがな表記必須の語リスト
- 年齢表記のルール
- 文章表現のルール
- 敬語表現の削除ルール
- 学名・遺伝子名のフォーマットルール
- 特殊記号のルール
- 感情表現禁止リスト

### 2. `医学用語整形関数.ts`
TypeScript版の整形関数実装。

**主要関数：**
- `applyMedicalTermRules()` - 医学用語ルールを適用
- `formatMedicalText()` - 統合整形関数（エラー・警告も返す）
- `checkForbiddenExpressions()` - 禁止された感情表現をチェック
- `normalizeSpecialSymbols()` - 特殊記号を正規化

### 3. `医学用語整形関数.js`
JavaScript版の整形関数実装（Node.js環境で動作）。

### 4. `医学用語整形AIプロンプト.md`
AI（ChatGPT、Claude等）に整形を依頼する際に使用するプロンプト。

### 5. `医学用語整形README.md`
機能の使用方法、統合方法、カスタマイズ方法を記載したドキュメント。

## 使用方法

### アプリケーション統合

```typescript
import { formatMedicalText } from './医学用語整形関数';

// テキストを整形
const result = formatMedicalText(userInput);

// 整形後のテキストを使用
const formattedText = result.formattedText;

// エラー・警告を表示
if (result.errors.length > 0) {
  showErrors(result.errors);
}
```

### AIプロンプトでの使用

`医学用語整形AIプロンプト.md`の内容を参照して、AIに整形を依頼するプロンプトを作成。

## 適用される主なルール

1. **人名由来病名**：アプガール→Apgar、ファロー→Fallot等
2. **検査名**：エコー→超音波検査、レントゲン→X線検査
3. **薬剤呼称**：抗生剤→抗菌薬
4. **医学用語**：奇形→先天異常、痙攣→けいれん
5. **ひらがな表記**：一旦→いったん、全て→すべて等
6. **年齢表記**：ヶ月→か月、才→歳
7. **文章表現**：週間前より→週前から
8. **敬語削除**：ご家族→家族、～していただいた→～した
9. **特殊記号**：pH、µ（マイクロ）等の正規化
10. **感情表現検出**：無念、残念等の禁止表現を検出

## 統合ポイント

### 症例要約作成アプリへの統合箇所

1. **入力時整形**（リアルタイム）
   - ユーザーがテキストを入力する際に自動整形
   - 入力フィールドのonChangeイベントで呼び出し

2. **保存時整形**（自動）
   - 保存前に全テキストを整形
   - データベースに保存される前に適用

3. **エクスポート時整形**（自動）
   - PDF/Word出力時に整形
   - エクスポート関数内で呼び出し

4. **手動整形ボタン**（ユーザー操作）
   - UIに「整形」ボタンを配置
   - ユーザーが任意のタイミングで整形可能

### バリデーションとの連携

```typescript
// 整形 → バリデーションの順で実行
const formatted = formatMedicalText(caseData.text);
const validation = validateFormattedText(formatted.formattedText);
```

## カスタマイズ方法

### ルールの追加

`医学用語ルール定義.json`を編集：

```json
{
  "人名由来病名": {
    "rules": [
      {
        "pattern": "新しいパターン",
        "replacement": "置換後",
        "regex": false
      }
    ]
  }
}
```

### 関数の拡張

`医学用語整形関数.ts`に独自のロジックを追加。

## 次のステップ

1. **アプリケーションへの統合**
   - 症例要約作成アプリに整形関数を統合
   - UIに整形ボタンを追加

2. **テスト実装**
   - 各ルールのユニットテスト
   - 統合テスト

3. **パフォーマンス最適化**
   - 大量テキストの処理
   - リアルタイム整形の最適化

4. **ユーザーフィードバック**
   - 追加したいルールの収集
   - 使用感の改善

## 参考資料

- `症例要約作成ルール.md` - 元のルールドキュメント
- `Manas開発指示書.md` - アプリケーション全体の仕様（更新済み）
- `医学用語整形README.md` - 詳細な使用方法
